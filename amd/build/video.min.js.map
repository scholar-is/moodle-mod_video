{"version":3,"file":"video.min.js","sources":["../src/video.js"],"sourcesContent":["import Plyr from 'mod_video/plyr';\nimport Ajax from 'core/ajax';\n\nexport default class Video {\n\n    constructor(cm, instance, options) {\n        this.session = null;\n\n        this.elapsedseconds = 0;\n\n        this.player = new Plyr(`#player-${instance.id}`, options);\n\n        if (options.resumeTime) {\n            this.player.currentTime = parseInt(options.resumeTime);\n        }\n\n        setInterval(() => this.tick(), 1000);\n\n        setInterval(() => this.recordUpdates(), 10000);\n\n        this.player.on('playing', async () => {\n            if (!this.sessionInitialized) {\n                this.sessionInitialized = true;\n                const response = await this.createSession(cm.id);\n                this.session = response.session;\n            }\n        });\n    }\n\n    tick() {\n        if (this.player && this.player.playing) {\n            this.elapsedseconds += this.player.speed;\n        }\n    }\n\n    recordUpdates() {\n        if (this.player && this.elapsedseconds > 0) {\n            Ajax.call([{\n                methodname: 'mod_video_record_session_updates',\n                args: {\n                    sessionid: this.session.id,\n                    timeelapsed: this.elapsedseconds,\n                    currenttime: parseInt(this.player.currentTime),\n                    currentpercent: this.player.currentTime / this.player.duration,\n                }\n            }]);\n            this.elapsedseconds = 0;\n        }\n    }\n\n    createSession(cmid) {\n        return Ajax.call([{\n            methodname: 'mod_video_create_session',\n            args: { cmid }\n        }])[0];\n    }\n}\n"],"names":["Video","cm","instance","options","session","elapsedseconds","player","Plyr","id","resumeTime","currentTime","parseInt","setInterval","_this","tick","recordUpdates","on","sessionInitialized","createSession","response","this","playing","speed","call","methodname","args","sessionid","timeelapsed","currenttime","currentpercent","duration","cmid","Ajax"],"mappings":"+zBAGqBA,gCAELC,GAAIC,SAAUC,4KACjBC,QAAU,UAEVC,eAAiB,OAEjBC,OAAS,IAAIC,gCAAgBL,SAASM,IAAML,SAE7CA,QAAQM,kBACHH,OAAOI,YAAcC,SAASR,QAAQM,aAG/CG,aAAY,kBAAMC,MAAKC,SAAQ,KAE/BF,aAAY,kBAAMC,MAAKE,kBAAiB,UAEnCT,OAAOU,GAAG,uCAAW,wIACjBH,MAAKI,iDACNJ,MAAKI,oBAAqB,kBACHJ,MAAKK,cAAcjB,GAAGO,WAAvCW,uBACNN,MAAKT,QAAUe,SAASf,+cAKpC,WACQgB,KAAKd,QAAUc,KAAKd,OAAOe,eACtBhB,gBAAkBe,KAAKd,OAAOgB,oCAI3C,WACQF,KAAKd,QAAUc,KAAKf,eAAiB,kBAChCkB,KAAK,CAAC,CACPC,WAAY,mCACZC,KAAM,CACFC,UAAWN,KAAKhB,QAAQI,GACxBmB,YAAaP,KAAKf,eAClBuB,YAAajB,SAASS,KAAKd,OAAOI,aAClCmB,eAAgBT,KAAKd,OAAOI,YAAcU,KAAKd,OAAOwB,kBAGzDzB,eAAiB,gCAI9B,SAAc0B,aACHC,cAAKT,KAAK,CAAC,CACdC,WAAY,2BACZC,KAAM,CAAEM,KAAAA,SACR"}