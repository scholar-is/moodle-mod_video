define("mod_video/video_manager",["exports","core/ajax","core/notification","core/templates"],(function(_exports,_ajax,_notification,_templates){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates);return _exports.default=class{constructor(uniqueId,videoSourceType,options){this.uniqueId=uniqueId,this.videoSourceType=videoSourceType,this.options=options,this.root=document.getElementById("video-manager-"+this.uniqueId),this.resultContainer=document.querySelector("#video-manager-".concat(this.uniqueId," .video-results-container")),this.searchInput=document.querySelector("#video-manager-".concat(this.uniqueId," input[name=search-videos-value]")),this.searchButton=document.querySelector("#video-manager-".concat(this.uniqueId," .search-videos-button")),this.loadingIconContainer=document.querySelector("#video-manager-".concat(this.uniqueId," .loading-icon-container")),this.videoResults={total:0,videos:[]},this.init()}async init(){this.log("video_manager:init:uniqueid",this.uniqueId),this.log("video_manager:init:options",this.options),this.searchButton.addEventListener("click",(async()=>{await this.query(),await this.refreshResults()})),this.searchInput.addEventListener("keypress",(async e=>{"Enter"===e.key&&(e.preventDefault(),await this.query(),await this.refreshResults())})),await this.query(),await this.refreshResults()}async query(){this.log("video_manager:query",this.searchInput.value),this.setLoading(!0);try{this.videoResults=(await this.queryVideos(this.searchInput.value)).results}catch(e){await _notification.default.exception(e)}}async refreshResults(){const renderedResults=await Promise.all(this.videoResults.videos.map((async videoResult=>{const{html:html}=await _templates.default.renderForPromise("mod_video/video_manager_result",videoResult);return html})));this.resultContainer.innerHTML=renderedResults.join("");document.querySelectorAll("#video-manager-".concat(this.uniqueId," .select-video-button")).forEach((button=>{button.addEventListener("click",(e=>{const selectedVideoResult=this.videoResults.videos.find((r=>r.videoid===e.target.dataset.videoid));this.options.onVideoSelect&&this.options.onVideoSelect(selectedVideoResult)}))})),this.setLoading(!1)}setLoading(loading){loading?this.loadingIconContainer.classList.remove("hidden"):this.loadingIconContainer.classList.add("hidden")}queryVideos(query){return _ajax.default.call([{methodname:"mod_video_query_videos",args:{query:query,videosourcetype:this.videoSourceType}}])[0]}log(){if(this.options.debug){for(var _len=arguments.length,data=new Array(_len),_key=0;_key<_len;_key++)data[_key]=arguments[_key];console.log(data)}}},_exports.default}));

//# sourceMappingURL=video_manager.min.js.map