define("mod_video/video",["exports","mod_video/plyr","core/ajax"],(function(_exports,_plyr,_ajax){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_plyr=_interopRequireDefault(_plyr),_ajax=_interopRequireDefault(_ajax);var Video=function(){function Video(cm,instance,options){var fn,_this=this;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Video),this.session=null,this.elapsedseconds=0,this.player=new _plyr.default("#player-".concat(instance.id),options),options.resumeTime&&(this.player.currentTime=parseInt(options.resumeTime)),setInterval((function(){return _this.tick()}),1e3),setInterval((function(){return _this.recordUpdates()}),1e4),this.player.on("playing",(fn=regeneratorRuntime.mark((function _callee(){var response;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(_this.sessionInitialized){_context.next=6;break}return _this.sessionInitialized=!0,_context.next=4,_this.createSession(cm.id);case 4:response=_context.sent,_this.session=response.session;case 6:case"end":return _context.stop()}}),_callee)})),function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}))}var Constructor,protoProps,staticProps;return Constructor=Video,(protoProps=[{key:"tick",value:function(){this.player&&this.player.playing&&(this.elapsedseconds+=this.player.speed)}},{key:"recordUpdates",value:function(){this.player&&this.elapsedseconds>0&&(_ajax.default.call([{methodname:"mod_video_record_session_updates",args:{sessionid:this.session.id,timeelapsed:this.elapsedseconds,currenttime:parseInt(this.player.currentTime),currentpercent:this.player.currentTime/this.player.duration}}]),this.elapsedseconds=0)}},{key:"createSession",value:function(cmid){return _ajax.default.call([{methodname:"mod_video_create_session",args:{cmid:cmid}}])[0]}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Video}();return _exports.default=Video,_exports.default}));

//# sourceMappingURL=video.min.js.map