{"version":3,"file":"video_manager.min.js","sources":["../src/video_manager.js"],"sourcesContent":["import Ajax from 'core/ajax';\nimport {exception as displayException} from 'core/notification';\nimport Templates from 'core/templates';\n\nexport default class VideoManager {\n\n    constructor(uniqueId, options) {\n        this.uniqueId = uniqueId;\n        this.options = options;\n\n        this.root = document.getElementById('video-manager-' + this.uniqueId);\n        this.resultContainer = document.querySelector(`#video-manager-${this.uniqueId} .card-columns`);\n        this.searchInput = document.querySelector(`#video-manager-${this.uniqueId} input[name=search-videos-value]`);\n        this.searchButton = document.querySelector(`#video-manager-${this.uniqueId} .search-videos-button`);\n\n        this.videoResults = [];\n\n        void this.init();\n    }\n\n    async init() {\n        this.log(\"video_manager:init:uniqueid\", this.uniqueId);\n        this.log(\"video_manager:init:options\", this.options);\n\n        this.searchButton.addEventListener('click', async () => {\n            console.log(\"CLICK\");\n\n            await this.query();\n            await this.refreshResults();\n        });\n\n        this.searchInput.addEventListener('keypress', async (e) => {\n            if (e.key === 'Enter') {\n                e.preventDefault();\n                await this.query();\n                await this.refreshResults();\n            }\n        });\n    }\n\n    async query() {\n        this.videoResults = (await this.queryVideos(this.searchInput.value)).results;\n    }\n\n    async refreshResults() {\n        const renderedResults = await Promise.all(this.videoResults.map(async (videoResult) => {\n            const { html } = await Templates.renderForPromise('mod_video/video_manager_result', videoResult);\n            return html;\n        }));\n\n        this.resultContainer.innerHTML = renderedResults.join('');\n\n        const queryString = `#video-manager-${this.uniqueId} .select-video-button`;\n        const buttons = document.querySelectorAll(`#video-manager-${this.uniqueId} .select-video-button`);\n\n        console.log(queryString, buttons);\n\n        buttons.forEach((button) => {\n            console.log(button);\n            button.addEventListener('click', (e) => {\n                const selectedVideoResult = this.videoResults.find((r) => r.videoid === e.target.dataset.videoid);\n                if (this.options.onVideoSelect) {\n                    this.options.onVideoSelect(selectedVideoResult);\n                }\n            });\n        });\n    }\n\n    queryVideos(query) {\n        return Ajax.call([{\n            methodname: 'mod_video_query_videos',\n            args: {\n                query\n            }\n        }])[0];\n    }\n\n    /**\n     * Wrapper for `console.log` that conditionally logs based on the `debug` setting for this cm.\n     * @param {any} data\n     */\n    log(...data) {\n        if (this.options.debug) {\n            // eslint-disable-next-line no-console\n            console.log(data);\n        }\n    }\n}\n"],"names":["constructor","uniqueId","options","root","document","getElementById","this","resultContainer","querySelector","searchInput","searchButton","videoResults","init","log","addEventListener","async","console","query","refreshResults","e","key","preventDefault","queryVideos","value","results","renderedResults","Promise","all","map","html","Templates","renderForPromise","videoResult","innerHTML","join","queryString","buttons","querySelectorAll","forEach","button","selectedVideoResult","find","r","videoid","target","dataset","onVideoSelect","Ajax","call","methodname","args","debug","data"],"mappings":"maAMIA,YAAYC,SAAUC,cACbD,SAAWA,cACXC,QAAUA,aAEVC,KAAOC,SAASC,eAAe,iBAAmBC,KAAKL,eACvDM,gBAAkBH,SAASI,uCAAgCF,KAAKL,iCAChEQ,YAAcL,SAASI,uCAAgCF,KAAKL,mDAC5DS,aAAeN,SAASI,uCAAgCF,KAAKL,yCAE7DU,aAAe,GAEfL,KAAKM,yBAILC,IAAI,8BAA+BP,KAAKL,eACxCY,IAAI,6BAA8BP,KAAKJ,cAEvCQ,aAAaI,iBAAiB,SAASC,UACxCC,QAAQH,IAAI,eAENP,KAAKW,cACLX,KAAKY,yBAGVT,YAAYK,iBAAiB,YAAYC,MAAAA,IAC5B,UAAVI,EAAEC,MACFD,EAAEE,uBACIf,KAAKW,cACLX,KAAKY,wCAMdP,oBAAsBL,KAAKgB,YAAYhB,KAAKG,YAAYc,QAAQC,qCAI/DC,sBAAwBC,QAAQC,IAAIrB,KAAKK,aAAaiB,KAAIb,MAAAA,oBACtDc,KAAEA,YAAeC,mBAAUC,iBAAiB,iCAAkCC,oBAC7EH,cAGNtB,gBAAgB0B,UAAYR,gBAAgBS,KAAK,UAEhDC,qCAAgC7B,KAAKL,kCACrCmC,QAAUhC,SAASiC,0CAAmC/B,KAAKL,mCAEjEe,QAAQH,IAAIsB,YAAaC,SAEzBA,QAAQE,SAASC,SACbvB,QAAQH,IAAI0B,QACZA,OAAOzB,iBAAiB,SAAUK,UACxBqB,oBAAsBlC,KAAKK,aAAa8B,MAAMC,GAAMA,EAAEC,UAAYxB,EAAEyB,OAAOC,QAAQF,UACrFrC,KAAKJ,QAAQ4C,oBACR5C,QAAQ4C,cAAcN,2BAM3ClB,YAAYL,cACD8B,cAAKC,KAAK,CAAC,CACdC,WAAY,yBACZC,KAAM,CACFjC,MAAAA,UAEJ,GAORJ,SACQP,KAAKJ,QAAQiD,MAAO,+BADrBC,6CAAAA,2BAGCpC,QAAQH,IAAIuC"}